<%
  id ||= "character-count-#{SecureRandom.hex(4)}"
  value ||= nil
  rows ||= 5
  data ||= nil
  spellcheck ||= "true"

  label ||= nil
  hint ||= nil
  error_message ||= nil
  hint_id = "hint-#{SecureRandom.hex(4)}" if hint
  error_message_id = "error-message-#{SecureRandom.hex(4)}" if error_message

  css_classes = %w(gem-c-textarea govuk-textarea js-character-count)
  css_classes << "govuk-textarea--error" if error_message
  form_group_css_classes = %w(govuk-form-group)
  form_group_css_classes << "govuk-form-group--error" if error_message

  aria_described_by ||= nil
  if hint || error_message
    aria_described_by = []
    aria_described_by << hint_id if hint
    aria_described_by << error_message_id if error_message
    aria_described_by = aria_described_by.join(" ")
  end

  maxlength ||= nil
  maxwords ||= nil
  threshold ||= nil
%>

<%= content_tag :div,
  class: "govuk-character-count",
  data: {
    module: "character-count",
    maxlength: maxlength,
    maxwords: maxwords,
    threshold: threshold
  } do %>

  <%= render "govuk_publishing_components/components/hint", {
    id: hint_id,
    text: hint
  } %>


  <%= content_tag :div, class: form_group_css_classes do %>
    <% if label %>
      <%= render "govuk_publishing_components/components/label", { html_for: id }.merge(label.symbolize_keys) %>
    <% end %>

    <% if hint %>
      <%= render "govuk_publishing_components/components/hint", {
        id: hint_id,
        text: hint
      } %>
    <% end %>

    <% if error_message %>
      <%= render "govuk_publishing_components/components/error_message", {
        id: error_message_id,
        text: error_message
      } %>
    <% end %>

    <%= tag.textarea name: name,
      value: value,
      class: css_classes,
      id: id,
      rows: rows,
      data: data,
      spellcheck: spellcheck,
      aria: {
        describedby: aria_described_by
      } do %><%= value %><% end %>
  <% end %>
  <span id="<%= id %>-info" class="govuk-hint govuk-character-count__message" aria-live="polite">
    You can enter up to <%= maxlength || maxwords %> <%= maxwords ? 'words' : 'characters' %>
  </span>
<% end %>
